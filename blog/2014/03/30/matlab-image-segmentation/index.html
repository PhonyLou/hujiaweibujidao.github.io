
<!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>Hujiawei Bujidao</title>

  <meta name="author" content="hujiawei">
  
  <meta name="description" content="Matlab Image Segmentation Mar 30th, 2014 1.基于迭代的自动阈值图像分割方法 参考文献: 基于迭代(自动阈值)算法的医学图像增强方法 该文献实现了全局和局部的图像分割代码，使用的都是迭代算法，对比下面的结果可以看出，在灰度差异特别大的图像中， &hellip;">
  
  

  <link rel="canonical" href="http://hujiaweibujidao.github.io/blog/2014/03/30/matlab-image-segmentation">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hujiawei Bujidao" type="application/atom+xml">
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">Hujiawei Bujidao</a></h1>
  
    <p>I will always be your savior! A secret makes a man man!</p>
  
</div>
<ul id="social-links">
  
    <li><a class="feed" href="/atom.xml" title="RSS">RSS</a></li>
  
  
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  
</ul>

    <div id="main"> <div class="post-header">
  
    <h1 class="post-title">Matlab Image Segmentation</h1>
  
  








  


<time datetime="2014-03-30T16:13:00+08:00" pubdate data-updated="true">Mar 30<span>th</span>, 2014</time>
</div>

<div class="post-content"><p>1.基于迭代的自动阈值图像分割方法</p>

<p>参考文献: <a href="/files/image_segmentation.pdf">基于迭代(自动阈值)算法的医学图像增强方法</a></p>

<p>该文献实现了全局和局部的图像分割代码，使用的都是迭代算法，对比下面的结果可以看出，在灰度差异特别大的图像中，局部阈值分割要比全局阈值分割表现更好。[注:我对源码略有修改]</p>

<p>1.1 全局阈值分割程序</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>original_image=imread('test1.png');
</span><span class='line'>gray_image=rgb2gray(original_image);
</span><span class='line'>gray_image=double(gray_image);
</span><span class='line'>t=mean(gray_image(:));
</span><span class='line'>is_done=false;
</span><span class='line'>count=0;%迭代次数
</span><span class='line'>block=gray_image(1:end,1:end);%不分块
</span><span class='line'>while ~is_done
</span><span class='line'>    r1=find(gray_image&lt;=t);
</span><span class='line'>    r2=find(gray_image&gt;t);
</span><span class='line'>    temp1=mean(block(r1));
</span><span class='line'>    if isnan(temp1);
</span><span class='line'>        temp1=0;
</span><span class='line'>    end
</span><span class='line'>    temp2=mean(block(r2));
</span><span class='line'>    if isnan(temp2)
</span><span class='line'>        temp2=0;
</span><span class='line'>    end
</span><span class='line'>    t_new=(temp1+temp2)/2;
</span><span class='line'>    is_done=abs(t_new-t)&lt;1;%差异阈值是1
</span><span class='line'>    t=t_new;
</span><span class='line'>    count=count+1;
</span><span class='line'>    if count&gt;=1000
</span><span class='line'>        Error='Error:Cannot find the ideal threshold.'
</span><span class='line'>        return
</span><span class='line'>    end
</span><span class='line'>end
</span><span class='line'>[m,n]=size(gray_image);
</span><span class='line'>result=zeros(m,n)+255;
</span><span class='line'>result(r1)=0;
</span><span class='line'>% resule(r2)=255;
</span><span class='line'>result=uint8(result);
</span><span class='line'>figure
</span><span class='line'>imshow(result);</span></code></pre></td></tr></table></div></figure>


<p>1.2 局部阈值分割程序</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>original_image=imread('test1.png');
</span><span class='line'>gray_image=rgb2gray(original_image);
</span><span class='line'>gray_image=double(gray_image);
</span><span class='line'>[m,n]=size(gray_image);
</span><span class='line'>result=zeros(m,n);
</span><span class='line'>block_size=70;%分块大小
</span><span class='line'>for i=1:block_size:m
</span><span class='line'>    for j=1:block_size:n
</span><span class='line'>        if ((i+block_size)&gt;m)&&((j+block_size)&gt;n)
</span><span class='line'>            block=gray_image(i:end,j:end);
</span><span class='line'>        elseif ((i+block_size)&gt;m)&&((j+block_size)&lt;=n)
</span><span class='line'>            block=gray_image(i:end,j:j+block_size-1);
</span><span class='line'>        elseif ((i+block_size)&lt;=m)&&((j+block_size)&gt;n)
</span><span class='line'>            block=gray_image(i:i+block_size-1,j:end);
</span><span class='line'>        else
</span><span class='line'>            block=gray_image(i:i+block_size-1,j:j+block_size-1);
</span><span class='line'>        end
</span><span class='line'>        t=mean(block(:)); t_org=t; is_done=false; count=0;
</span><span class='line'>        while ~is_done
</span><span class='line'>            r1=find(block&lt;=t); r2=find(block&gt;t); temp1=mean(block(r1));
</span><span class='line'>            if isnan(temp1);
</span><span class='line'>                temp1=0;
</span><span class='line'>            end
</span><span class='line'>            temp2=mean(block(r2));
</span><span class='line'>            if isnan(temp2)
</span><span class='line'>                temp2=0;
</span><span class='line'>            end
</span><span class='line'>            t_new=(temp1+temp2)/2; is_done=abs(t_new-t)&lt;1; t=t_new;
</span><span class='line'>            count=count+1;
</span><span class='line'>            if count&gt;=1000
</span><span class='line'>                Error='Error:Cannot find the ideal threshold.'
</span><span class='line'>                return
</span><span class='line'>            end
</span><span class='line'>        end
</span><span class='line'>        block(r1)=0;
</span><span class='line'>        block(r2)=255;
</span><span class='line'>        if ((i+block_size)&gt;m)&&((j+block_size)&gt;n)
</span><span class='line'>            result(i:end,j:end)=block;
</span><span class='line'>        elseif ((i+block_size)&gt;m)&&((j+block_size)&lt;=n)
</span><span class='line'>            result(i:end,j:j+block_size-1)=block;
</span><span class='line'>        elseif ((i+block_size)&lt;=m)&&((j+block_size)&gt;n)
</span><span class='line'>            result(i:i+block_size-1,j:end)=block;
</span><span class='line'>        else
</span><span class='line'>            result(i:i+block_size-1,j:j+block_size-1)=block;
</span><span class='line'>        end
</span><span class='line'>    end
</span><span class='line'>end
</span><span class='line'>resule=uint8(result);
</span><span class='line'>figure
</span><span class='line'>imshow(result);</span></code></pre></td></tr></table></div></figure>


<p>对比结果：</p>

<p><img src="/images/201403/whole.png" width="320" height="210"> <img src="/images/201403/partial.png" width="320" height="210"></p>

<p>2.基于OSTU算法的自动阈值图像分割</p>

<p>[这块我还没有细究&hellip;To be continued&hellip;&hellip;]</p>

<p>Matlab内置的<code>graythresh</code>使用的便是OSTU算法，使得白色像素和黑色像素的类间方差最大。</p>

<p>因为上面测试图像的亮度存在明显的水平差异，所以我写了一个将图像沿水平方向分成几部分分别进行OSTU算法，效果明显又比上面两种方式要好些。</p>

<p><img src="/images/201403/postu.png"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function [ result ] = partialostu( image,part,isrgb )
</span><span class='line'>%PARTIALOSTU partial image ostu
</span><span class='line'>if isrgb
</span><span class='line'>    image=rgb2gray(image);
</span><span class='line'>end
</span><span class='line'>cols=size(image,2);
</span><span class='line'>result=zeros(size(image));
</span><span class='line'>for i=1:part
</span><span class='line'>    fstart=floor((i-1)*cols/part)+1;
</span><span class='line'>    fend=floor(i*cols/part);
</span><span class='line'>    f=image(:,fstart:fend);
</span><span class='line'>    t=graythresh(f);
</span><span class='line'>    f=im2bw(f,t);
</span><span class='line'>    result(:,fstart:fend)=f;
</span><span class='line'>end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p class='post-footer'>
                        Original link:<a href='http://hujiaweibujidao.github.io/blog/2014/03/30/matlab-image-segmentation/'>http://hujiaweibujidao.github.io/blog/2014/03/30/matlab-image-segmentation/</a><br/>Written by <a href='http://hujiaweibujidao.github.io'>hujiawei</a>&nbsp;Posted at <a href='http://hujiaweibujidao.github.io'>http://hujiaweibujidao.github.io</a><br/>Feel free to read or comment it, and if you want to copy it into your own site, please copy it with its Original Link showed above or you can see the license below for more details.<br />Thanks a lot. Hope you enjoy here! ^_^</p>

</div>


<div class="post-single">
  <div class="post-meta">
    

<span class="categories">
  Categories:
  
    <a class='category' href='/blog/categories/matlab/'>matlab</a>
  
</span>


    
      <div class="sharing">
  
  
  
</div>

    
  </div>
  <div class="clear"></div>

  
</div>
 </div>
    <div id="footer">
  <div class="panels">
    <div class="license">
      <h2>License</h2>
      <p>如非特别声明，本 Blog 的文章由 hujiawei 创作，采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">知识共享署名-非商业性使用-相同方式共享 3.0 Unported 许可协议</a>进行许可。</p>
    </div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2014/04/24/calculus-summary/">Calculus Summary</a>
          </li>
        
          <li>
            <a href="/blog/2014/04/23/numerical-methods-using-matlab/">Numerical Methods using Matlab</a>
          </li>
        
          <li>
            <a href="/blog/2014/04/22/probability-and-statistics-summary/">probability and statistics summary</a>
          </li>
        
          <li>
            <a href="/blog/2014/04/15/flying-on-mac/">Flying on Mac</a>
          </li>
        
          <li>
            <a href="/blog/2014/04/13/vertext-cover-problem/">Vertext Cover Problem</a>
          </li>
        
      </ul>
    </div>

    <div class="douban">
      <h2>Reading</h2>
      
        <p>Please set your Douban ID in _config.yml</p>
      
    </div>
  </div>

  <p class="powered">
    Powered by <a href="http://octopress.org">Octopress</a> and <a href="https://github.com/iwinux/compbits">Compbits</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  

  


  

  

  

</body>
</html>
